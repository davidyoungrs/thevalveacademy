module.exports=[63021,(a,b,c)=>{b.exports=a.x("@prisma/client-2c3a283f134fdcb6",()=>require("@prisma/client-2c3a283f134fdcb6"))},66518,a=>{"use strict";var b=a.i(63021);let c=globalThis.prismaGlobal??new b.PrismaClient;a.s(["default",0,c])},92509,(a,b,c)=>{b.exports=a.x("url",()=>require("url"))},21517,(a,b,c)=>{b.exports=a.x("http",()=>require("http"))},54799,(a,b,c)=>{b.exports=a.x("crypto",()=>require("crypto"))},49719,(a,b,c)=>{b.exports=a.x("assert",()=>require("assert"))},45706,(a,b,c)=>{b.exports=a.x("querystring",()=>require("querystring"))},874,(a,b,c)=>{b.exports=a.x("buffer",()=>require("buffer"))},6461,(a,b,c)=>{b.exports=a.x("zlib",()=>require("zlib"))},24836,(a,b,c)=>{b.exports=a.x("https",()=>require("https"))},27699,(a,b,c)=>{b.exports=a.x("events",()=>require("events"))},75096,a=>{a.v({name:"openid-client",version:"5.7.1",description:"OpenID Connect Relying Party (RP, Client) implementation for Node.js runtime, supports passportjs",keywords:["auth","authentication","basic","certified","client","connect","dynamic","electron","hybrid","identity","implicit","oauth","oauth2","oidc","openid","passport","relying party","strategy"],homepage:"https://github.com/panva/openid-client",repository:"panva/openid-client",funding:{url:"https://github.com/sponsors/panva"},license:"MIT",author:"Filip Skokan <panva.ip@gmail.com>",exports:{types:"./types/index.d.ts",import:"./lib/index.mjs",require:"./lib/index.js"},main:"./lib/index.js",types:"./types/index.d.ts",files:["lib","types/index.d.ts"],scripts:{format:"npx prettier --loglevel silent --write ./lib ./test ./certification ./types",test:"mocha test/**/*.test.js"},dependencies:{jose:"^4.15.9","lru-cache":"^6.0.0","object-hash":"^2.2.0","oidc-token-hash":"^5.0.3"},devDependencies:{"@types/node":"^16.18.106","@types/passport":"^1.0.16",base64url:"^3.0.1",chai:"^4.5.0",mocha:"^10.7.3",nock:"^13.5.5",prettier:"^2.8.8","readable-mock-req":"^0.2.2",sinon:"^9.2.4",timekeeper:"^2.3.1"},"standard-version":{scripts:{postchangelog:"sed -i '' -e 's/### \\[/## [/g' CHANGELOG.md"},types:[{type:"feat",section:"Features"},{type:"fix",section:"Fixes"},{type:"chore",hidden:!0},{type:"docs",hidden:!0},{type:"style",hidden:!0},{type:"refactor",section:"Refactor",hidden:!1},{type:"perf",section:"Performance",hidden:!1},{type:"test",hidden:!0}]}})},35087,a=>{"use strict";var b=a.i(37936);let c={SUBMITTED:["AWAITING_TRAINER_CONFIRMATION","NO_TRAINER_AVAILABLE"],AWAITING_TRAINER_CONFIRMATION:["TRAINER_CONFIRMED","REJECTED","NO_TRAINER_AVAILABLE"],TRAINER_CONFIRMED:["AWAITING_APPROVER_1","REJECTED"],AWAITING_APPROVER_1:["CONFIRMED","AWAITING_APPROVER_2","REJECTED"],AWAITING_APPROVER_2:["CONFIRMED","REJECTED"],CONFIRMED:[],REJECTED:["SUBMITTED"],NO_TRAINER_AVAILABLE:["SUBMITTED","REJECTED"]};var d=a.i(66518),e=a.i(20971),f=a.i(9307),g=a.i(18558);async function h(a,b,h){var i;let j,k=await (0,e.getServerSession)(f.authOptions);if(!k||!k.user)return{error:"Unauthorized"};k.user.role;let l=await d.default.trainingRequest.findUnique({where:{id:a}});if(!l)return{error:"Request not found"};let m=function(a,b,c){if("REJECT"===b)return"REJECTED";switch(a){case"AWAITING_TRAINER_CONFIRMATION":return"TRAINER_CONFIRMED";case"TRAINER_CONFIRMED":return"AWAITING_APPROVER_1";case"AWAITING_APPROVER_1":if(c>20)return"AWAITING_APPROVER_2";return"CONFIRMED";case"AWAITING_APPROVER_2":return"CONFIRMED";default:return a}}(l.status,b,l.discountPercent);return(i=l.status,(j=c[i])&&j.includes(m))?(await d.default.trainingRequest.update({where:{id:a},data:{status:m,approvals:{create:{userId:k.user.id,stage:l.status,decision:b,reason:h}}}}),"CONFIRMED"===m&&l.trainerId&&await d.default.calendarEvent.create({data:{requestId:l.id,trainerId:l.trainerId,start:l.startDate,end:l.endDate,type:"CONFIRMED"}}),(0,g.revalidatePath)(`/requests/${l.reference}`),(0,g.revalidatePath)("/trainer/inbox"),(0,g.revalidatePath)("/approver/inbox"),{success:!0}):{error:`Invalid transition from ${l.status} to ${m}`}}(0,a.i(13095).ensureServerEntryExports)([h]),(0,b.registerServerReference)(h,"7062e699aa03441fd84b38e747106717a80ab31706",null),a.s([],60475),a.i(60475),a.s(["7062e699aa03441fd84b38e747106717a80ab31706",()=>h],35087)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__1dd11620._.js.map