{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/davidyoung/Desktop/Valve%20Academy%20web/src/lib/workflow.ts"],"sourcesContent":["export type RequestStatus =\n    | \"SUBMITTED\"\n    | \"AWAITING_TRAINER_CONFIRMATION\"\n    | \"TRAINER_CONFIRMED\"\n    | \"AWAITING_APPROVER_1\"\n    | \"AWAITING_APPROVER_2\"\n    | \"CONFIRMED\"\n    | \"REJECTED\"\n    | \"NO_TRAINER_AVAILABLE\";\n\nexport const ALLOWED_TRANSITIONS: Record<RequestStatus, RequestStatus[]> = {\n    SUBMITTED: [\"AWAITING_TRAINER_CONFIRMATION\", \"NO_TRAINER_AVAILABLE\"],\n    AWAITING_TRAINER_CONFIRMATION: [\"TRAINER_CONFIRMED\", \"REJECTED\", \"NO_TRAINER_AVAILABLE\"], // Trainer accepts or rejects\n    TRAINER_CONFIRMED: [\"AWAITING_APPROVER_1\", \"REJECTED\"],\n    AWAITING_APPROVER_1: [\"CONFIRMED\", \"AWAITING_APPROVER_2\", \"REJECTED\"], // Appr 1 accepts (-> Confirmed or Appr 2) or rejects\n    AWAITING_APPROVER_2: [\"CONFIRMED\", \"REJECTED\"],\n    CONFIRMED: [], // Terminal\n    REJECTED: [\"SUBMITTED\"], // Can be resubmitted (maybe creates new request or resets this one?)\n    NO_TRAINER_AVAILABLE: [\"SUBMITTED\", \"REJECTED\"], // Admin can re-trigger or reject\n};\n\nexport const ROLE_PERMISSIONS: Record<string, RequestStatus[]> = {\n    SALES: [\"SUBMITTED\"], // Sales can only \"Submit\" (create)\n    TRAINER: [\"TRAINER_CONFIRMED\", \"REJECTED\", \"AWAITING_TRAINER_CONFIRMATION\"], // Trainer can act on these\n    APPROVER: [\"CONFIRMED\", \"REJECTED\", \"AWAITING_APPROVER_2\"],\n    ADMIN: [\"SUBMITTED\", \"AWAITING_TRAINER_CONFIRMATION\", \"TRAINER_CONFIRMED\", \"AWAITING_APPROVER_1\", \"AWAITING_APPROVER_2\", \"CONFIRMED\", \"REJECTED\", \"NO_TRAINER_AVAILABLE\"],\n};\n\nexport function canTransition(currentStatus: string, nextStatus: string): boolean {\n    const allowed = ALLOWED_TRANSITIONS[currentStatus as RequestStatus];\n    return allowed ? allowed.includes(nextStatus as RequestStatus) : false;\n}\n\nexport function getNextStatus(currentStatus: string, action: \"APPROVE\" | \"REJECT\", discountPercent: number): string {\n    if (action === \"REJECT\") return \"REJECTED\";\n\n    switch (currentStatus) {\n        case \"AWAITING_TRAINER_CONFIRMATION\":\n            return \"TRAINER_CONFIRMED\";\n        case \"TRAINER_CONFIRMED\":\n            return \"AWAITING_APPROVER_1\";\n        case \"AWAITING_APPROVER_1\":\n            // If discount > 20%, need Approver 2\n            if (discountPercent > 20) return \"AWAITING_APPROVER_2\";\n            return \"CONFIRMED\";\n        case \"AWAITING_APPROVER_2\":\n            return \"CONFIRMED\";\n        default:\n            return currentStatus;\n    }\n}\n"],"names":[],"mappings":";;;;;;;;;;AAUO,MAAM,sBAA8D;IACvE,WAAW;QAAC;QAAiC;KAAuB;IACpE,+BAA+B;QAAC;QAAqB;QAAY;KAAuB;IACxF,mBAAmB;QAAC;QAAuB;KAAW;IACtD,qBAAqB;QAAC;QAAa;QAAuB;KAAW;IACrE,qBAAqB;QAAC;QAAa;KAAW;IAC9C,WAAW,EAAE;IACb,UAAU;QAAC;KAAY;IACvB,sBAAsB;QAAC;QAAa;KAAW;AACnD;AAEO,MAAM,mBAAoD;IAC7D,OAAO;QAAC;KAAY;IACpB,SAAS;QAAC;QAAqB;QAAY;KAAgC;IAC3E,UAAU;QAAC;QAAa;QAAY;KAAsB;IAC1D,OAAO;QAAC;QAAa;QAAiC;QAAqB;QAAuB;QAAuB;QAAa;QAAY;KAAuB;AAC7K;AAEO,SAAS,cAAc,aAAqB,EAAE,UAAkB;IACnE,MAAM,UAAU,mBAAmB,CAAC,cAA+B;IACnE,OAAO,UAAU,QAAQ,QAAQ,CAAC,cAA+B;AACrE;AAEO,SAAS,cAAc,aAAqB,EAAE,MAA4B,EAAE,eAAuB;IACtG,IAAI,WAAW,UAAU,OAAO;IAEhC,OAAQ;QACJ,KAAK;YACD,OAAO;QACX,KAAK;YACD,OAAO;QACX,KAAK;YACD,qCAAqC;YACrC,IAAI,kBAAkB,IAAI,OAAO;YACjC,OAAO;QACX,KAAK;YACD,OAAO;QACX;YACI,OAAO;IACf;AACJ"}},
    {"offset": {"line": 96, "column": 0}, "map": {"version":3,"sources":["file:///Users/davidyoung/Desktop/Valve%20Academy%20web/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst prismaClientSingleton = () => {\n    return new PrismaClient()\n}\n\ndeclare global {\n    var prismaGlobal: undefined | ReturnType<typeof prismaClientSingleton>\n}\n\nconst prisma = globalThis.prismaGlobal ?? prismaClientSingleton()\n\nexport default prisma\n\nif (process.env.NODE_ENV !== 'production') globalThis.prismaGlobal = prisma\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,wBAAwB;IAC1B,OAAO,IAAI,sMAAY;AAC3B;AAMA,MAAM,SAAS,WAAW,YAAY,IAAI;uCAE3B;AAEf,wCAA2C,WAAW,YAAY,GAAG"}},
    {"offset": {"line": 166, "column": 0}, "map": {"version":3,"sources":["file:///Users/davidyoung/Desktop/Valve%20Academy%20web/src/lib/auth.ts"],"sourcesContent":["import { NextAuthOptions } from \"next-auth\";\nimport CredentialsProvider from \"next-auth/providers/credentials\";\nimport prisma from \"@/lib/prisma\";\n\nexport const authOptions: NextAuthOptions = {\n    providers: [\n        CredentialsProvider({\n            name: \"Credentials\",\n            credentials: {\n                email: { label: \"Email\", type: \"email\", placeholder: \"sales@valveacademy.com\" },\n                password: { label: \"Password\", type: \"password\" },\n            },\n            async authorize(credentials) {\n                if (!credentials?.email || !credentials?.password) return null;\n\n                const user = await prisma.user.findUnique({\n                    where: { email: credentials.email },\n                });\n\n                if (!user) return null;\n\n                // In production, use bcrypt/argon2 to verify passwordHash\n                // For MVP/Demo, we compare as is (seed uses 'password123')\n                if (credentials.password === user.passwordHash) {\n                    return {\n                        id: user.id,\n                        name: user.name,\n                        email: user.email,\n                        role: user.role,\n                    };\n                }\n                return null;\n            },\n        }),\n    ],\n    callbacks: {\n        async jwt({ token, user }) {\n            if (user) {\n                token.role = user.role;\n                token.id = user.id;\n            }\n            return token;\n        },\n        async session({ session, token }) {\n            if (session.user) {\n                (session.user as any).role = token.role;\n                (session.user as any).id = token.id;\n            }\n            return session;\n        },\n    },\n    pages: {\n        signIn: \"/login\",\n    },\n    session: {\n        strategy: \"jwt\",\n    },\n};\n"],"names":[],"mappings":";;;;AACA;AACA;;;AAEO,MAAM,cAA+B;IACxC,WAAW;QACP,IAAA,mKAAmB,EAAC;YAChB,MAAM;YACN,aAAa;gBACT,OAAO;oBAAE,OAAO;oBAAS,MAAM;oBAAS,aAAa;gBAAyB;gBAC9E,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YACpD;YACA,MAAM,WAAU,WAAW;gBACvB,IAAI,CAAC,aAAa,SAAS,CAAC,aAAa,UAAU,OAAO;gBAE1D,MAAM,OAAO,MAAM,+HAAM,CAAC,IAAI,CAAC,UAAU,CAAC;oBACtC,OAAO;wBAAE,OAAO,YAAY,KAAK;oBAAC;gBACtC;gBAEA,IAAI,CAAC,MAAM,OAAO;gBAElB,0DAA0D;gBAC1D,2DAA2D;gBAC3D,IAAI,YAAY,QAAQ,KAAK,KAAK,YAAY,EAAE;oBAC5C,OAAO;wBACH,IAAI,KAAK,EAAE;wBACX,MAAM,KAAK,IAAI;wBACf,OAAO,KAAK,KAAK;wBACjB,MAAM,KAAK,IAAI;oBACnB;gBACJ;gBACA,OAAO;YACX;QACJ;KACH;IACD,WAAW;QACP,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACrB,IAAI,MAAM;gBACN,MAAM,IAAI,GAAG,KAAK,IAAI;gBACtB,MAAM,EAAE,GAAG,KAAK,EAAE;YACtB;YACA,OAAO;QACX;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC5B,IAAI,QAAQ,IAAI,EAAE;gBACb,QAAQ,IAAI,CAAS,IAAI,GAAG,MAAM,IAAI;gBACtC,QAAQ,IAAI,CAAS,EAAE,GAAG,MAAM,EAAE;YACvC;YACA,OAAO;QACX;IACJ;IACA,OAAO;QACH,QAAQ;IACZ;IACA,SAAS;QACL,UAAU;IACd;AACJ"}},
    {"offset": {"line": 238, "column": 0}, "map": {"version":3,"sources":["file:///Users/davidyoung/Desktop/Valve%20Academy%20web/src/app/actions/workflow.ts"],"sourcesContent":["\"use server\";\n\nimport { canTransition, getNextStatus } from \"@/lib/workflow\";\nimport prisma from \"@/lib/prisma\";\nimport { getServerSession } from \"next-auth\";\nimport { authOptions } from \"@/lib/auth\";\nimport { revalidatePath } from \"next/cache\";\n\nexport async function processWorkflowAction(\n    requestId: string,\n    action: \"APPROVE\" | \"REJECT\",\n    reason?: string\n) {\n    const session = await getServerSession(authOptions);\n    if (!session || !session.user) return { error: \"Unauthorized\" };\n\n    const userRole = (session.user as any).role;\n    // TODO: Add strict RBAC check based on current status vs user role\n\n    const request = await prisma.trainingRequest.findUnique({\n        where: { id: requestId },\n    });\n\n    if (!request) return { error: \"Request not found\" };\n\n    const nextStatus = getNextStatus(request.status, action, request.discountPercent);\n\n    if (!canTransition(request.status, nextStatus)) {\n        return { error: `Invalid transition from ${request.status} to ${nextStatus}` };\n    }\n\n    // Update Request\n    await prisma.trainingRequest.update({\n        where: { id: requestId },\n        data: {\n            status: nextStatus,\n            approvals: {\n                create: {\n                    userId: (session.user as any).id,\n                    stage: request.status,\n                    decision: action,\n                    reason: reason,\n                },\n            },\n            // If CONFIRMED, we might want to create the final CalendarEvent here\n        },\n    });\n\n    if (nextStatus === \"CONFIRMED\") {\n        // Create Confirmed Calendar Event\n        if (request.trainerId) {\n            // Check if one exists first?\n            // Just create new confirmed event\n            await prisma.calendarEvent.create({\n                data: {\n                    requestId: request.id,\n                    trainerId: request.trainerId,\n                    start: request.startDate,\n                    end: request.endDate,\n                    type: \"CONFIRMED\",\n                }\n            });\n\n            // Also maybe delete TENTATIVE ones?\n        }\n    }\n\n    // TODO: Trigger Email Notifications\n\n    revalidatePath(`/requests/${request.reference}`);\n    revalidatePath(\"/trainer/inbox\");\n    revalidatePath(\"/approver/inbox\");\n    return { success: true };\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;;;;;;;;AAEO,eAAe,sBAClB,SAAiB,EACjB,MAA4B,EAC5B,MAAe;IAEf,MAAM,UAAU,MAAM,IAAA,yJAAgB,EAAC,iIAAW;IAClD,IAAI,CAAC,WAAW,CAAC,QAAQ,IAAI,EAAE,OAAO;QAAE,OAAO;IAAe;IAE9D,MAAM,WAAW,AAAC,QAAQ,IAAI,CAAS,IAAI;IAC3C,mEAAmE;IAEnE,MAAM,UAAU,MAAM,+HAAM,CAAC,eAAe,CAAC,UAAU,CAAC;QACpD,OAAO;YAAE,IAAI;QAAU;IAC3B;IAEA,IAAI,CAAC,SAAS,OAAO;QAAE,OAAO;IAAoB;IAElD,MAAM,aAAa,IAAA,uIAAa,EAAC,QAAQ,MAAM,EAAE,QAAQ,QAAQ,eAAe;IAEhF,IAAI,CAAC,IAAA,uIAAa,EAAC,QAAQ,MAAM,EAAE,aAAa;QAC5C,OAAO;YAAE,OAAO,CAAC,wBAAwB,EAAE,QAAQ,MAAM,CAAC,IAAI,EAAE,YAAY;QAAC;IACjF;IAEA,iBAAiB;IACjB,MAAM,+HAAM,CAAC,eAAe,CAAC,MAAM,CAAC;QAChC,OAAO;YAAE,IAAI;QAAU;QACvB,MAAM;YACF,QAAQ;YACR,WAAW;gBACP,QAAQ;oBACJ,QAAQ,AAAC,QAAQ,IAAI,CAAS,EAAE;oBAChC,OAAO,QAAQ,MAAM;oBACrB,UAAU;oBACV,QAAQ;gBACZ;YACJ;QAEJ;IACJ;IAEA,IAAI,eAAe,aAAa;QAC5B,kCAAkC;QAClC,IAAI,QAAQ,SAAS,EAAE;YACnB,6BAA6B;YAC7B,kCAAkC;YAClC,MAAM,+HAAM,CAAC,aAAa,CAAC,MAAM,CAAC;gBAC9B,MAAM;oBACF,WAAW,QAAQ,EAAE;oBACrB,WAAW,QAAQ,SAAS;oBAC5B,OAAO,QAAQ,SAAS;oBACxB,KAAK,QAAQ,OAAO;oBACpB,MAAM;gBACV;YACJ;QAEA,oCAAoC;QACxC;IACJ;IAEA,oCAAoC;IAEpC,IAAA,+IAAc,EAAC,CAAC,UAAU,EAAE,QAAQ,SAAS,EAAE;IAC/C,IAAA,+IAAc,EAAC;IACf,IAAA,+IAAc,EAAC;IACf,OAAO;QAAE,SAAS;IAAK;AAC3B;;;IAjEsB;;AAAA,+OAAA"}},
    {"offset": {"line": 327, "column": 0}, "map": {"version":3,"sources":["file:///Users/davidyoung/Desktop/Valve%20Academy%20web/.next-internal/server/app/requests/%5Breference%5D/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {processWorkflowAction as '7071eea652842acfddef1c5cb27751da7f5db7600c'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}