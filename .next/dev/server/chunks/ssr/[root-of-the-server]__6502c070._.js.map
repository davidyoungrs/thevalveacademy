{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/davidyoung/Desktop/Valve%20Academy%20web/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst prismaClientSingleton = () => {\n    return new PrismaClient()\n}\n\ndeclare global {\n    var prismaGlobal: undefined | ReturnType<typeof prismaClientSingleton>\n}\n\nconst prisma = globalThis.prismaGlobal ?? prismaClientSingleton()\n\nexport default prisma\n\nif (process.env.NODE_ENV !== 'production') globalThis.prismaGlobal = prisma\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,wBAAwB;IAC1B,OAAO,IAAI,sMAAY;AAC3B;AAMA,MAAM,SAAS,WAAW,YAAY,IAAI;uCAE3B;AAEf,wCAA2C,WAAW,YAAY,GAAG"}},
    {"offset": {"line": 20, "column": 0}, "map": {"version":3,"sources":["file:///Users/davidyoung/Desktop/Valve%20Academy%20web/src/lib/validations.ts"],"sourcesContent":["import { z } from \"zod\";\n\nexport const requestSchema = z.object({\n    customerName: z.string().min(2, \"Customer name is required\"),\n    customerEmail: z.string().email(\"Invalid email address\"),\n    numAttendees: z.number().int().min(2, \"At least 2 attendees are required\").max(10, \"Maximum 10 attendees allowed\"),\n    deliveryType: z.enum([\"ONLINE\", \"ONSITE\"]),\n    siteDetails: z.string().optional(),\n    startDate: z.string().refine((val) => !isNaN(Date.parse(val)), \"Invalid start date\"),\n    endDate: z.string().refine((val) => !isNaN(Date.parse(val)), \"Invalid end date\"),\n    notes: z.string().optional(),\n    discountPercent: z.number().min(0).max(100).optional(),\n    discountReason: z.string().optional(),\n    moduleId: z.string().min(1, \"Module is required\"),\n}).refine((data) => {\n    if (data.deliveryType === \"ONSITE\" && (!data.siteDetails || data.siteDetails.length < 3)) {\n        return false;\n    }\n    return true;\n}, {\n    message: \"Site details are required for onsite training\",\n    path: [\"siteDetails\"],\n});\n\nexport type RequestFormData = z.infer<typeof requestSchema>;\n"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,gBAAgB,kLAAC,CAAC,MAAM,CAAC;IAClC,cAAc,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IAChC,eAAe,kLAAC,CAAC,MAAM,GAAG,KAAK,CAAC;IAChC,cAAc,kLAAC,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC,GAAG,qCAAqC,GAAG,CAAC,IAAI;IACnF,cAAc,kLAAC,CAAC,IAAI,CAAC;QAAC;QAAU;KAAS;IACzC,aAAa,kLAAC,CAAC,MAAM,GAAG,QAAQ;IAChC,WAAW,kLAAC,CAAC,MAAM,GAAG,MAAM,CAAC,CAAC,MAAQ,CAAC,MAAM,KAAK,KAAK,CAAC,OAAO;IAC/D,SAAS,kLAAC,CAAC,MAAM,GAAG,MAAM,CAAC,CAAC,MAAQ,CAAC,MAAM,KAAK,KAAK,CAAC,OAAO;IAC7D,OAAO,kLAAC,CAAC,MAAM,GAAG,QAAQ;IAC1B,iBAAiB,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC,KAAK,QAAQ;IACpD,gBAAgB,kLAAC,CAAC,MAAM,GAAG,QAAQ;IACnC,UAAU,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;AAChC,GAAG,MAAM,CAAC,CAAC;IACP,IAAI,KAAK,YAAY,KAAK,YAAY,CAAC,CAAC,KAAK,WAAW,IAAI,KAAK,WAAW,CAAC,MAAM,GAAG,CAAC,GAAG;QACtF,OAAO;IACX;IACA,OAAO;AACX,GAAG;IACC,SAAS;IACT,MAAM;QAAC;KAAc;AACzB"}},
    {"offset": {"line": 110, "column": 0}, "map": {"version":3,"sources":["file:///Users/davidyoung/Desktop/Valve%20Academy%20web/src/lib/auth.ts"],"sourcesContent":["import { NextAuthOptions } from \"next-auth\";\nimport CredentialsProvider from \"next-auth/providers/credentials\";\nimport prisma from \"@/lib/prisma\";\n\nexport const authOptions: NextAuthOptions = {\n    providers: [\n        CredentialsProvider({\n            name: \"Credentials\",\n            credentials: {\n                email: { label: \"Email\", type: \"email\", placeholder: \"sales@valveacademy.com\" },\n                password: { label: \"Password\", type: \"password\" },\n            },\n            async authorize(credentials) {\n                if (!credentials?.email || !credentials?.password) return null;\n\n                const user = await prisma.user.findUnique({\n                    where: { email: credentials.email },\n                });\n\n                if (!user) return null;\n\n                // In production, use bcrypt/argon2 to verify passwordHash\n                // For MVP/Demo, we compare as is (seed uses 'password123')\n                if (credentials.password === user.passwordHash) {\n                    return {\n                        id: user.id,\n                        name: user.name,\n                        email: user.email,\n                        role: user.role,\n                    };\n                }\n                return null;\n            },\n        }),\n    ],\n    callbacks: {\n        async jwt({ token, user }) {\n            if (user) {\n                token.role = user.role;\n                token.id = user.id;\n            }\n            return token;\n        },\n        async session({ session, token }) {\n            if (session.user) {\n                (session.user as any).role = token.role;\n                (session.user as any).id = token.id;\n            }\n            return session;\n        },\n    },\n    pages: {\n        signIn: \"/login\",\n    },\n    session: {\n        strategy: \"jwt\",\n    },\n};\n"],"names":[],"mappings":";;;;AACA;AACA;;;AAEO,MAAM,cAA+B;IACxC,WAAW;QACP,IAAA,mKAAmB,EAAC;YAChB,MAAM;YACN,aAAa;gBACT,OAAO;oBAAE,OAAO;oBAAS,MAAM;oBAAS,aAAa;gBAAyB;gBAC9E,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YACpD;YACA,MAAM,WAAU,WAAW;gBACvB,IAAI,CAAC,aAAa,SAAS,CAAC,aAAa,UAAU,OAAO;gBAE1D,MAAM,OAAO,MAAM,+HAAM,CAAC,IAAI,CAAC,UAAU,CAAC;oBACtC,OAAO;wBAAE,OAAO,YAAY,KAAK;oBAAC;gBACtC;gBAEA,IAAI,CAAC,MAAM,OAAO;gBAElB,0DAA0D;gBAC1D,2DAA2D;gBAC3D,IAAI,YAAY,QAAQ,KAAK,KAAK,YAAY,EAAE;oBAC5C,OAAO;wBACH,IAAI,KAAK,EAAE;wBACX,MAAM,KAAK,IAAI;wBACf,OAAO,KAAK,KAAK;wBACjB,MAAM,KAAK,IAAI;oBACnB;gBACJ;gBACA,OAAO;YACX;QACJ;KACH;IACD,WAAW;QACP,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACrB,IAAI,MAAM;gBACN,MAAM,IAAI,GAAG,KAAK,IAAI;gBACtB,MAAM,EAAE,GAAG,KAAK,EAAE;YACtB;YACA,OAAO;QACX;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC5B,IAAI,QAAQ,IAAI,EAAE;gBACb,QAAQ,IAAI,CAAS,IAAI,GAAG,MAAM,IAAI;gBACtC,QAAQ,IAAI,CAAS,EAAE,GAAG,MAAM,EAAE;YACvC;YACA,OAAO;QACX;IACJ;IACA,OAAO;QACH,QAAQ;IACZ;IACA,SAAS;QACL,UAAU;IACd;AACJ"}},
    {"offset": {"line": 182, "column": 0}, "map": {"version":3,"sources":["file:///Users/davidyoung/Desktop/Valve%20Academy%20web/src/lib/utils.ts"],"sourcesContent":["import { type ClassValue, clsx } from \"clsx\";\nimport { twMerge } from \"tailwind-merge\";\n\nexport function cn(...inputs: ClassValue[]) {\n    return twMerge(clsx(inputs));\n}\n\nexport function generateReference() {\n    const date = new Date();\n    const yyyy = date.getFullYear();\n    const mm = String(date.getMonth() + 1).padStart(2, \"0\");\n    const dd = String(date.getDate()).padStart(2, \"0\");\n    const random = Math.floor(1000 + Math.random() * 9000);\n    return `VA-${yyyy}${mm}${dd}-${random}`;\n}\n\nexport function calculatePrice(\n    deliveryType: \"ONLINE\" | \"ONSITE\",\n    attendees: number,\n    onlinePrice: number,\n    onsitePrice: number\n) {\n    if (deliveryType === \"ONLINE\") {\n        return onlinePrice * attendees;\n    } else {\n        // Basic onsite logic: price per head for MVP, can be tiered later\n        return onsitePrice * attendees;\n    }\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACtC,OAAO,IAAA,sKAAO,EAAC,IAAA,6IAAI,EAAC;AACxB;AAEO,SAAS;IACZ,MAAM,OAAO,IAAI;IACjB,MAAM,OAAO,KAAK,WAAW;IAC7B,MAAM,KAAK,OAAO,KAAK,QAAQ,KAAK,GAAG,QAAQ,CAAC,GAAG;IACnD,MAAM,KAAK,OAAO,KAAK,OAAO,IAAI,QAAQ,CAAC,GAAG;IAC9C,MAAM,SAAS,KAAK,KAAK,CAAC,OAAO,KAAK,MAAM,KAAK;IACjD,OAAO,CAAC,GAAG,EAAE,OAAO,KAAK,GAAG,CAAC,EAAE,QAAQ;AAC3C;AAEO,SAAS,eACZ,YAAiC,EACjC,SAAiB,EACjB,WAAmB,EACnB,WAAmB;IAEnB,IAAI,iBAAiB,UAAU;QAC3B,OAAO,cAAc;IACzB,OAAO;QACH,kEAAkE;QAClE,OAAO,cAAc;IACzB;AACJ"}},
    {"offset": {"line": 217, "column": 0}, "map": {"version":3,"sources":["file:///Users/davidyoung/Desktop/Valve%20Academy%20web/src/app/actions/requests.ts"],"sourcesContent":["\"use server\";\n\nimport prisma from \"@/lib/prisma\";\nimport { requestSchema } from \"@/lib/validations\";\nimport { getServerSession } from \"next-auth\";\nimport { authOptions } from \"@/lib/auth\";\nimport { generateReference, calculatePrice } from \"@/lib/utils\";\nimport { revalidatePath } from \"next/cache\";\nimport { redirect } from \"next/navigation\";\n\nexport async function submitTrainingRequest(formData: any) {\n    const session = await getServerSession(authOptions);\n\n    if (!session || !session.user) {\n        return { error: \"Unauthorized\" };\n    }\n\n    const validation = requestSchema.safeParse(formData);\n\n    if (!validation.success) {\n        return { error: \"Validation failed\", details: validation.error.flatten() };\n    }\n\n    const data = validation.data;\n\n    // Fetch module for pricing\n    const moduleData = await prisma.module.findUnique({\n        where: { id: data.moduleId },\n        include: { trainers: { orderBy: { priorityOrder: 'asc' } } }\n    });\n\n    if (!moduleData) {\n        return { error: \"Module not found\" };\n    }\n\n    const price = calculatePrice(\n        data.deliveryType,\n        data.numAttendees,\n        moduleData.onlinePricePerAttendee,\n        moduleData.onsitePricePerAttendee\n    );\n\n    // Apply discount if any\n    let finalPrice = price;\n    if (data.discountPercent && data.discountPercent > 0) {\n        finalPrice = price * (1 - data.discountPercent / 100);\n    }\n\n    // Generate Reference\n    let reference = generateReference();\n    // Ensure uniqueness (simple retry loop)\n    let existing = await prisma.trainingRequest.findUnique({ where: { reference } });\n    while (existing) {\n        reference = generateReference();\n        existing = await prisma.trainingRequest.findUnique({ where: { reference } });\n    }\n\n    // Determine initial status\n    // For MVP, if discount > 20%, go to Approver? Or just start mostly as SUBMITTED/AWAITING_TRAINER\n    // Requirements say: SUBMITTED -> AWAITING_TRAINER_CONFIRMATION\n    const initialStatus = \"AWAITING_TRAINER_CONFIRMATION\";\n\n    // Attempt auto-assign trainer\n    let assignedTrainerId = null;\n    let assignedStatus = initialStatus;\n\n    const startDateObj = new Date(data.startDate);\n    const endDateObj = new Date(data.endDate);\n\n    for (const trainerRel of moduleData.trainers) {\n        const tpId = trainerRel.trainerProfileId;\n\n        // Check for BusyBlocks\n        const busyBlocks = await prisma.busyBlock.count({\n            where: {\n                trainerProfileId: tpId,\n                startDate: { lte: endDateObj },\n                endDate: { gte: startDateObj },\n            }\n        });\n\n        if (busyBlocks > 0) continue;\n\n        // Check for Confirmed Calendar Events (need userId for this usually, but CalendarEvent links to User(trainerId))\n        // First get the User ID for this profile\n        const trainerProfile = await prisma.trainerProfile.findUnique({\n            where: { id: tpId },\n            include: { user: true }\n        });\n\n        if (!trainerProfile) continue;\n        const tUserId = trainerProfile.user.id;\n\n        const conflicts = await prisma.calendarEvent.count({\n            where: {\n                trainerId: tUserId,\n                type: \"CONFIRMED\",\n                start: { lte: endDateObj },\n                end: { gte: startDateObj },\n            }\n        });\n\n        if (conflicts === 0) {\n            assignedTrainerId = tUserId;\n            break; // Found one!\n        }\n    }\n\n    if (!assignedTrainerId) {\n        assignedStatus = \"NO_TRAINER_AVAILABLE\";\n        // If no trainer is available, we still create the request but flag it\n    }\n\n    // Note: if no trainer, status could be NO_TRAINER_AVAILABLE, but let's stick to happy path for MVP init\n\n    try {\n        const newRequest = await prisma.trainingRequest.create({\n            data: {\n                reference,\n                customerName: data.customerName,\n                customerEmail: data.customerEmail,\n                numAttendees: data.numAttendees,\n                deliveryType: data.deliveryType,\n                siteDetails: data.siteDetails,\n                startDate: new Date(data.startDate),\n                endDate: new Date(data.endDate),\n                notes: data.notes,\n                finalPrice,\n                discountPercent: data.discountPercent || 0,\n                discountReason: data.discountReason,\n                status: assignedStatus,\n                moduleId: data.moduleId,\n                salespersonId: (session.user as any).id,\n                trainerId: assignedTrainerId,\n            },\n        });\n\n        // In a real app, trigger email here (await sendEmail(...))\n\n        revalidatePath(\"/requests\");\n        return { success: true, reference: newRequest.reference };\n    } catch (error) {\n        console.error(\"Submission error:\", error);\n        return { error: \"Failed to create request\" };\n    }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 392, "column": 0}, "map": {"version":3,"sources":["file:///Users/davidyoung/Desktop/Valve%20Academy%20web/.next-internal/server/app/request/new/%5BmoduleNo%5D/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {submitTrainingRequest as '40b8c1c22ab8e98a92af3aae39b36aaf7ef022d14a'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}